<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StudyAdvisor | Command Center</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #8b5cf6; --primary-glow: rgba(139, 92, 246, 0.4);
      --bg: #020617; --card: rgba(15, 23, 42, 0.6);
      --border: rgba(255, 255, 255, 0.1); --text: #f8fafc;
      --accent: #ec4899; --success: #10b981;
    }
    * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.3s ease; }
    body { margin: 0; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; justify-content: center; padding: 40px 20px; }
    
    .dashboard-grid { width: 100%; max-width: 1100px; display: grid; grid-template-columns: 1fr 350px; gap: 30px; }
    .glass-card { background: var(--card); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 24px; padding: 24px; }
    
    /* Stats Bar */
    .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
    .stat-box { text-align: center; position: relative; cursor: help; }
    .stat-value { font-size: 1.8rem; font-weight: 800; color: var(--text); }
    
    /* Subject List */
    .subject-block { margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
    .chapter-item { background: rgba(255,255,255,0.03); padding: 12px; border-radius: 12px; margin-top: 8px; border: 1px solid transparent; cursor: pointer; }
    .chapter-item:hover { border-color: var(--primary); background: rgba(139, 92, 246, 0.05); }
    .chapter-item.active { border-color: var(--primary); box-shadow: 0 0 15px var(--primary-glow); background: rgba(139, 92, 246, 0.1); }
    
    /* Tooltip */
    .stat-tooltip {
      position: absolute; top: 110%; left: 50%; transform: translateX(-50%);
      width: 220px; background: #0f172a; border: 1px solid var(--border); padding: 15px;
      border-radius: 12px; font-size: 0.75rem; opacity: 0; pointer-events: none; z-index: 10; text-align: left;
    }
    .stat-box:hover .stat-tooltip { opacity: 1; }

    input[type="range"] { width: 100%; accent-color: var(--primary); margin-top: 8px; }
    button { cursor: pointer; border: none; font-weight: 800; border-radius: 12px; padding: 12px 20px; }
    .btn-main { background: var(--primary); color: white; width: 100%; font-size: 1.1rem; box-shadow: 0 10px 20px var(--primary-glow); }
    .btn-ghost { background: transparent; border: 1px solid var(--border); color: var(--text); font-size: 0.7rem; }

    @media (max-width: 850px) { .dashboard-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

<div class="dashboard-grid">
  <main class="col">
    <div class="glass-card" style="margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin:0; font-weight: 800; letter-spacing: -1px;">SYLLABUS ARCHITECT</h2>
            <button class="btn-ghost" onclick="addSubject()">+ NEW SUBJECT</button>
        </div>
        <div id="subjectsContainer"></div>
    </div>
  </main>

  <aside class="col">
    <div class="stats-row">
        <div class="glass-card stat-box">
            <div class="stat-value" id="statStreak">0</div>
            <small style="opacity:0.6">STREAK</small>
        </div>
        <div class="glass-card stat-box">
            <div class="stat-value" id="statPerf">0%</div>
            <small style="opacity:0.6">PROD. SCORE</small>
            <div class="stat-tooltip" id="scoreTooltip">Loading analysis...</div>
        </div>
    </div>

    <div class="glass-card" style="text-align: center;">
        <small style="color: var(--primary); font-weight: 800; letter-spacing: 2px;">READY TO ENGAGE?</small>
        <h3 id="activeTaskDisplay" style="margin: 15px 0; font-size: 1.2rem;">SELECT A CHAPTER</h3>
        <button class="btn-main" onclick="engageFocus()">LAUNCH DEEP WORK</button>
    </div>
  </aside>
</div>

<script>
const state = {
    subjects: JSON.parse(localStorage.getItem("studyData")) || [],
    streak: Number(localStorage.getItem("streak")) || 0,
    activeChapter: JSON.parse(localStorage.getItem("activeChapter")) || { sIdx: null, cIdx: null, name: "" },
    productivity: JSON.parse(localStorage.getItem("productivity")) || {
        score: 0, sessionsStarted: 0, sessionsCompleted: 0, pauses: 0, focusSecondsToday: 0, lastSessionDate: new Date().toDateString()
    }
};

function renderSubjects() {
    const container = document.getElementById("subjectsContainer");
    container.innerHTML = "";
    state.subjects.forEach((sub, sIdx) => {
        const block = document.createElement("div");
        block.className = "subject-block";
        block.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <strong style="color:var(--primary);">${sub.name.toUpperCase()}</strong>
                <button class="btn-ghost" onclick="addChapter(${sIdx})">+ CHAPTER</button>
            </div>
            ${sub.chapters.map((ch, cIdx) => `
                <div class="chapter-item ${state.activeChapter.sIdx === sIdx && state.activeChapter.cIdx === cIdx ? 'active' : ''}" 
                     onclick="setActiveChapter(${sIdx}, ${cIdx})">
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem;">
                        <span>${ch.name}</span>
                        <b>${ch.progress}%</b>
                    </div>
                    <input type="range" value="${ch.progress}" oninput="updateProgress(${sIdx}, ${cIdx}, this.value)">
                </div>
            `).join("")}
        `;
        container.appendChild(block);
    });
}

function setActiveChapter(sIdx, cIdx) {
    state.activeChapter = { sIdx, cIdx, name: state.subjects[sIdx].chapters[cIdx].name };
    localStorage.setItem("activeChapter", JSON.stringify(state.activeChapter));
    document.getElementById("activeTaskDisplay").textContent = state.activeChapter.name.toUpperCase();
    renderSubjects();
}

function updateProgress(sIdx, cIdx, val) {
    state.subjects[sIdx].chapters[cIdx].progress = val;
    localStorage.setItem("studyData", JSON.stringify(state.subjects));
    calculateScore();
}

function calculateScore() {
    const p = state.productivity;
    const focusScore = Math.min(p.focusSecondsToday / (4 * 3600), 1) * 40;
    const disciplineScore = p.sessionsStarted ? (p.sessionsCompleted / p.sessionsStarted) * 30 : 0;
    const intentBonus = state.activeChapter.sIdx !== null ? 15 : 0;
    const penalty = Math.min(p.pauses * 3, 15);
    
    p.score = Math.max(0, Math.min(100, Math.round(focusScore + disciplineScore + intentBonus - penalty)));
    document.getElementById("statPerf").textContent = p.score + "%";
    document.getElementById("statStreak").textContent = state.streak;
    
    document.getElementById("scoreTooltip").innerHTML = `
        <strong>ANALYSIS</strong>
        ‚è± Focus: ${Math.round(focusScore)} pts<br>
        üéØ Discipline: ${Math.round(disciplineScore)} pts<br>
        üìå Intent: +${intentBonus}<br>
        ‚õî Pauses: -${penalty}
    `;
}

function addSubject() {
    const n = prompt("Subject Name?");
    if(n) { state.subjects.push({ name: n, chapters: [] }); renderSubjects(); }
}

function addChapter(i) {
    const n = prompt("Chapter Name?");
    if(n) { state.subjects[i].chapters.push({ name: n, progress: 0 }); renderSubjects(); }
}

function engageFocus() {
    if (!state.activeChapter.name) return alert("Select a chapter first!");
    window.location.href = "focus.html";
}

renderSubjects();
calculateScore();
</script>
</body>
</html>
